---
title: "Final Color for BRE"
output: html_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
    fig.width = 8,
    fig.height = 6)

# Load Libraries:
library(colorspace)
library(magrittr)
library(tidyverse)
library(bre) # blackstone R package

set.seed(424429) # for reproducibility

##### colors:
breColors <- c("dark_blue" = "#283251",
                "light_grey" = "#eaeaeb",
                "med_grey" = "#cecece",
                "main_grey" = "#c0bfbf")

######## Data
items <- dplyr::tibble(
  pre_Organization = c(1, 2, 3, 4, 5, 4, 3, 2, 1),
  post_Organization = dplyr::if_else(pre_Organization < 5, pre_Organization + 1, pre_Organization),
  pre_Source = c(2, 2, 3, 5, 4, 3, 2, 1, 2),
  post_Source = dplyr::if_else(pre_Source < 4, pre_Source + 2, pre_Source),
  pre_Publish = c(1, 1, 1, 2, 2, 2, 3, 3, 3),
  post_Publish = pre_Publish + 2,
  pre_Write = c(2, 2, 2, 3, 3, 3, 4, 4, 4),
  post_Write = pre_Write + 1,
  pre_Research = c(1, 1, 2, 2, 3, 3, 4, 4, 4),
  post_Research = pre_Research + 1
)

items_single <- dplyr::tibble(
  Organization = c(1, 2, 3, 4, 5, 4, 3, 2, 1),
  Source = c(2, 2, 3, 5, 4, 3, 2, 1, 2),
  Publish = c(1, 1, 1, 2, 2, 2, 3, 3, 3),
  Write = c(2, 2, 2, 3, 3, 3, 4, 4, 4),
  Research = c(1, 1, 2, 2, 3, 3, 4, 4, 4),
)

# Set scale_labels for recodeCat function:
# scale_labels as a named character vector, items in correct order:
levels_min_ext_named <- c(
  "Minimal" = "1", "Slight" = "2", "Moderate" = "3",
  "Good" = "4", "Extensive" = "5"
)

# levels_min_ext as just the names from levels_min_ext_named:
levels_min_ext <- names(levels_min_ext_named) 
# Question labels as a named vector with the naming structure
# like this: c("new label" = "original variable name"):
question_labels <- c(
  "Publish a lot of high quality papers" = "Publish",
  "Write a lot of research papers" = "Write",
  "Research in a lab with faculty" = "Research",
  "Organization of a large research project" = "Organization",
  "Source work for a research paper" = "Source"
)

# Recode the numeric to factor variables using the levels from levels_min_ext and Select the factor variables:
cat_items <- bre::recodeCat(items, levels_min_ext_named) %>% dplyr::select(dplyr::where(is.factor))
cat_items_single <- bre::recodeCat(items_single, levels_min_ext_named) %>% dplyr::select(dplyr::where(is.factor))


######## Data: Strongly disagree to Strongly Agree
items_single_div <- dplyr::tibble(
  Organization = c(1, 2, 3, 4, 5, 6, 7, 7, 6, 5, 4, 3, 2, 1, 1),
  Source = c(2, 2, 3, 5, 4, 3, 2, 1, 2, 6, 6, 6, 7, 7,7),
  Publish = c(1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4 , 5, 6, 7, 6),
  Write = c(2, 2, 2, 3, 3, 3, 4, 4, 4, 5,6,7,1,2,3),
  Research = c(1, 1, 2, 2, 3, 3, 4, 4, 4, 5,6,7,1,2,3),
)

items_div <- dplyr::tibble(
  pre_Organization = items_single_div[["Organization"]],
  post_Organization = dplyr::if_else(pre_Organization < 7, pre_Organization + 1, pre_Organization),
  pre_Source = items_single_div[["Source"]],
  post_Source = dplyr::if_else(pre_Source < 5, pre_Source + 2, pre_Source),
  pre_Publish = items_single_div[["Publish"]],
  post_Publish = dplyr::if_else(pre_Publish < 6, pre_Publish + 2, pre_Publish),
  pre_Write = items_single_div[["Write"]],
  post_Write = dplyr::if_else(pre_Write < 7, pre_Write + 1, pre_Write),
  pre_Research = items_single_div[["Research"]],
  post_Research = dplyr::if_else(pre_Research < 7, pre_Research + 1, pre_Research) 
)

# Set scale_labels for recodeCat function:
# scale_labels as a named character vector, items in correct order:
levels_dis_agree_named <- c(
  "Strongly Disagree" = "1", "Somewhat Disagree" = "2", "Disagree" = "3",
  "Neither Agree or Disagree" = "4", "Agree" = "5", "Somewhat Agree" = "6", "Strongly Agree" = "7"
)

# levels_min_ext as just the names from levels_min_ext_named:
levels_dis_agree <- names(levels_dis_agree_named) 

# Recode the numeric to factor variables using the levels from levels_min_ext and Select the factor variables:
cat_items_div <- bre::recodeCat(items_div, levels_dis_agree_named) %>% dplyr::select(dplyr::where(is.factor))
cat_items_single_div <- bre::recodeCat(items_single_div, levels_dis_agree_named) %>% dplyr::select(dplyr::where(is.factor))

```

```{css, echo = FALSE}
body, ul, li{
  font-family: "Arial";
  font-size: 20px;
}

h1, h2, h3, h4, h5, h6 {
  font-family: "Arial";
}

h1 {
  background-color: #2C2C4F;
  color: white;
  font-size: 38px;
  font-weight: 500;
}

h2 {
  background-color: #dadada;
  color: #283251;
  font-size: 32px;
  font-weight: bold;
}

h3 {
  background-color: #dadada;
  color: #18323a;
  font-size: 28px;
  font-weight: bold;
}
    
h4 {
  color: #283251; 
  font-size: 26px;
}
  
h5 {
  color: #18323a; 
  font-size: 24px;
}

hr {
  height: 3px;
  background-color: #283251;
}

```

### Arrow charts without a grouping variable:

#### - With arrows in Blackstone dark blue "#283251"

```{r}
bre::arrowChart(df = items, scale_labels = levels_min_ext,
           overall_n = T, question_labels = question_labels, question_order = TRUE)

```


## Qualitative/Categorical Color Scales

### Arrow charts section with 3 grouping variables and an arrow for the whole sample labelled "Overall":

```{r, include=FALSE}
# add a grouping var to the data set `items`:
items_group <- dplyr::tibble(
   items,
   edu_level = factor(c(
       "grad", "undergrad", "grad", "undergrad", "grad",
       "undergrad", "undergrad", "grad", "undergrad"
  ), levels = c("grad", "undergrad"))
 )
```

### Arrow chart with new custom qualitative color scale based on `Okabe-Ito` colors:

#### - The "Overall" group will always be the color black:


```{r}
bre::arrowChartGroup(df = items_group, group = "edu_level", scale_labels = levels_min_ext, group_colors = rev(viridisLite::viridis(n = (length(unique(items_group[["edu_level"]])) + 1))),
    overall_n = FALSE, question_labels = NULL, question_order = FALSE)

grDevices::palette.colors(n = 9, palette = "Okabe-Ito")
"#000000"
"#E69F00" "#56B4E9" "#009E73" "#CC79A7" "#0072B2" "#D55E00" "#999999" "#440154FF" "#4AC16DFF"
c("#E69F00", "#56B4E9", "#009E73", "#277F8EFF", "#CC79A7", "#0072B2", "#D55E00","#440154FF", "#999999")

viridisLite::viridis(n = 12)
"#440154FF" "#46337EFF" "#365C8DFF" "#277F8EFF" "#1FA187FF" "#4AC16DFF" "#9FDA3AFF" "#FDE725FF"
"#440154FF" "#482173FF" "#433E85FF" "#38598CFF" "#2D708EFF" "#25858EFF" "#1E9B8AFF" "#2BB07FFF" "#51C56AFF" "#35B779FF" "#009E73" "#85D54AFF" "#C2DF23FF" "#FDE725FF"
```

```{r}
# create a labeled list of colors
qualColors <- c(
  `orange`  = "#E69F00",
  `sky blue`  = "#56B4E9",
  `bluish green`  = "#009E73",
  `magenta`  = "#CC79A7",
  `blue`  = "#0072B2",
  `vermillion` = "#D55E00",
  `viridis purple`  = "#440154FF",
  `dark grey` = "#999999",
  `bre blue` = "#283251")

# wrap that list in a callable function
customCols <- function(...) {
  cols <- c(...)
  if (is.null(cols))
    return (qualColors)
  qualColors[cols]
}


# There are 10 colors, so our max number of colors will be 10.
check_pal_n <- function(n, max_n) {
  if (n > max_n) {
    warning("This palette can handle a maximum of ", max_n, " values.",
            "You have supplied ", n, ".")
  } else if (n < 0) {
    stop("`n` must be a non-negative integer.")
  }
}

custom_cols()
```




```{r}
bre::arrowChartGroup(df = items_group, group = "edu_level", scale_labels = levels_min_ext, 
                     group_colors = grDevices::palette.colors(n = (length(unique(items_group[["edu_level"]])) + 1), palette = "Okabe-Ito"),
                     overall_n = FALSE, question_labels = NULL, question_order = FALSE)
```



## Horizontal Bar Chart with 7 racial categories

```{r, include=FALSE}
# New fake data for testing horzBarChart() colors with racial categories:
# Generate fake data
n <- 100  # number of observations

# Define racial categories
racial_categories <- c("Asian", "Hispanic or Latino", "Caucasian or White (non-Hispanic)", "African American or Black", "Native American or American Indian", 
                       "Native Hawaiian or other Pacific Islander", "Mixed Race")

# Set up the fake racial data as a tibble:
data <- dplyr::tibble(
  race = sample(racial_categories, n, replace = TRUE) # Generate random racial categories for each observation
)

# set up data for chart:
race_summ <- data %>%
  dplyr::select(race) %>%
  bre::dataSumm(sort_n = T)

# Filtered to only three categories:
three_race_summ <- race_summ %>% filter(response %in% c("Asian", "Hispanic or Latino", "African American or Black")) 
```

### Horizontal Bar Chart with `viridis` color scale:

```{r}
# horzBarChart() with viridis colors "#E69F00", "#56B4E9", "#009E73", 
bre::horzBarChart(df = race_summ, scale_colors = c("#E69F00", "#56B4E9", "#009E73","#CC79A7", "#0072B2", "#D55E00","#440154FF", "#999999", "#283251"), width = 0.6)

```


#### - Same palette, Only 3 categories, skipping yellow color in palette:

```{r}
# horzBarChart() with colors
bre::horzBarChart(df = three_race_summ, scale_colors = c("#440154FF", "#31688EFF", "#35B779FF"), width = 0.6)

```


### Horizontal Bar Chart with `Okabe-Ito` color scale:

```{r}
# horzBarChart() with Okabe-Ito colors
bre::horzBarChart(df = race_summ, scale_colors = grDevices::palette.colors(n = length(unique(data[["race"]])), palette = "Okabe-Ito"), width = 0.6)

```


#### - Same palette, Only 3 categories, skipping black color in palette:

```{r}
# horzBarChart() with colors
bre::horzBarChart(df = three_race_summ, scale_colors = c("#E69F00", "#56B4E9", "#009E73"), width = 0.6)

```


### Horizontal Bar Chart with `cividis` color scale:

```{r}
# horzBarChart() with cividis colors
bre::horzBarChart(df = race_summ, scale_colors = viridisLite::cividis(n = length(unique(data[["race"]]))), width = 0.6)

```

#### - Same palette, Only 3 categories:

```{r}
# horzBarChart() with cividis colors
bre::horzBarChart(df = three_race_summ, scale_colors = viridisLite::cividis(n = 3), width = 0.6)

```

<hr>

## Diverging Color Scale

### Stacked Pre-Post bar chart with `Blue Red 3` color palette on a 7 point scale:

```{r}
cat_items_div %>%
bre::stackedBarChart( 
   df = ., fill_color = "div", pre_post = T, scale_labels = levels_dis_agree,
   question_labels = question_labels, question_order = F, percent_label = TRUE, width = NULL, overall_n = T
)
```

### Stacked bar chart (single items) with `Blue Red 3` color palette on a 7 point scale:

```{r}
cat_items_single_div %>% 
bre::stackedBarChart( 
   df = ., fill_color = "div", pre_post = F, scale_labels = levels_dis_agree, 
    percent_label = TRUE, width = NULL, question_order = T, overall_n = F, question_labels = question_labels
) 

```


## Sequential Color Scales

### Stacked bar chart with `Blues 3` color scale:

```{r}
bre::stackedBarChart(
   df = cat_items_single, pre_post = FALSE, scale_labels = levels_min_ext,
   question_labels = NULL, percent_label = TRUE, width = NULL, overall_n = F
)
```



### Stacked bar chart with `cividis` color scale:

```{r}
# `Blues 3` from `colorspace` package
bre::stackedBarChart(
   df = cat_items_single, scale_labels = levels_min_ext,
   fill_color = viridisLite::cividis(n = length(levels_min_ext), alpha = 1, begin = 0, end = 1, direction = -1),
   question_labels = NULL, percent_label = TRUE, width = NULL, overall_n = T
)
```

#### - Same palette, Pre-post data:

```{r}
cat_items %>%
bre::stackedBarChart( 
   df = ., pre_post = T, scale_labels = levels_min_ext,
   fill_color = viridisLite::cividis(n = length(levels_min_ext), alpha = 1, begin = 0, end = 1, direction = -1),
   question_labels = question_labels, percent_label = TRUE, width = NULL, overall_n = F
)
```

