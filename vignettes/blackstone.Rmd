---
title: "Introduction to blackstone"
output: rmarkdown::html_vignette
description: >
  Start here if this is your first time using blackstone.
vignette: >
  %\VignetteIndexEntry{Introduction to blackstone}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup,  echo = FALSE, message = FALSE, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = FALSE, 
  message = FALSE, 
  out.width = "100%"
)
options(scipen = 999, digits = 4, # Prevents sci notation and sets the output of decimals to 4 (0.0000)
        tibble.print_min = 5L, tibble.print_max = 5L) # tibble only print 5 rows 
library(blackstone) # load Blackstone R package
set.seed(424629) # set reproducible seed
```


Blackstone Research and Evaluation uses the `R` programming language as its main tool for data analysis and visualization.
The main goal of `blackstone` is to make the process of coding in `R` as efficient as possible for everyone at Blackstone Research and Evaluation. 

In order to reach this goal, `blackstone` leverages established `R` packages and the [tidyverse](https://www.tidyverse.org/) family of `R` packages in particular. 
These packages use the system of "tidy data" to make data manipulation and analysis in `R` consistent and well organized, `blackstone` also strives to follow this philosophy. 

The vignettes provided with `blackstone` will go into greater detail as to how to use `blackstone` alongside these other packages.
This document introduces you to `blackstone` and how it fits into the basic workflow of data analysis and visualization at Blackstone Research and Evaluation.

## Overview of Data Workflow

* Import and clean data from survey provider.

* Simple data analysis and statistical inference.

* Data visualization and output for report writing.

## Importing data from SurveyMonkey

Our current survey provider is [SurveyMonkey](https://www.surveymonkey.com/?ut_source=homepage&ut_source3=header), `blackstone` contains several functions that makes the process of 
reading SurveyMonkey data into `R` a more manageable process and creates a codebook for the data along the way.

SurveyMonkey exports data with two header rows, which does not work in a straightforward with `R` where tibbles and dataframes can only have one row of names.

Here is how to import data from SurveyMonkey using example data provided with `blackstone`, this is a fake dataset of a pre (baseline) survey. 
There are three steps to this process:

1. Create a codebook.

```{r create_codebook}
# File path for pre example data:
pre_data_fp <- blackstone::blackstoneExample("sm_data_pre.csv")
# 1. Create the codebook:
codebook_pre <- blackstone::createCodebook(pre_data_fp)
codebook_pre
```
For this codebook, the first column `header_1` is the first header from the SurveyMonkey data, the second column `header_2` is the second header,
the third column `combined_header` is the combination of the two headers,
`position` is the column number for each `combined_header`, and `variable_name` is a cleaned up version for `combined_header` and
will be the column to edit to change the column names later on to shorter and more meaningful names.

`variable_name` will be the column that renames all the variables in the SurveyMonkey data.

2. Edit the codebook to create meaningful variable names.

```{r edit_codebook}
# Step 2. Edit the codebook: 
# Set up sequential naming convections for matrix-style questions with shared likert scale response options:
# 8 items that are matrix-style likert scales- turned into a scale called `research`- here is how to easily name them all at once:
# Rows 11 to 18 belong to the "research" matrix question (you will have to look at the codebook and match the header_1 and header_2 to variable_name to change)
research_items <- codebook_pre[["variable_name"]][11:18]
research_names <- paste0("research_", seq_along(research_items)) %>% purrr::set_names(., research_items) # Create a new named vector of names for these columns
# 6 items that are matrix-style likert scales- turned into a scale called `ability`- Rows 19 to 24 named `variable_name`:
ability_items <- codebook_pre[["variable_name"]][19:24]
ability_names <- paste0("ability_", seq_along(ability_items)) %>% purrr::set_names(., ability_items) # Create a new named vector of names for these columns
# 6 items that are matrix-style likert scales- turned into a scale called `ethics`- Rows 19 to 24 named `variable_name`:
ethics_items <- codebook_pre[["variable_name"]][25:29]
ethics_names <- paste0("ethics_", seq_along(ethics_items)) %>% purrr::set_names(., ethics_items) # Create a new named vector of names for these columns
# Edit the `variable_names` column: Use dplyr::mutate() and dplyr::case_match() to change the column `variable_name`:
codebook_pre <- codebook_pre %>% dplyr::mutate(
    variable_name = dplyr::case_match(
        variable_name, # column to match
        'custom_data_1' ~ "unique_id", # changes 'custom_data_1' to "unique_id"
        'to_what_extent_are_you_knowledgeable_in_conducting_research_in_your_field_of_study' ~ "knowledge",
        'with_which_gender_do_you_most_closely_identify' ~ "gender",
        'which_race_ethnicity_best_describes_you_please_choose_only_one' ~ "ethnicity",
        'are_you_a_first_generation_college_student' ~ "first_gen",
        names(research_names) ~ research_names[variable_name], # takes the above named vector and when the name matches, applies new value in that position as replacement.
        names(ability_names) ~ ability_names[variable_name],   # Same for `ability_names`
        names(ethics_names) ~ ethics_names[variable_name],   # Same for `ability_names`
        .default = variable_name # returns default value from original `variable_name` if not changed.
        )
    )
codebook_pre
# Write out the edited codebook to save for future use-
# Be sure to double check questions match new names before writing out:
# readr::write_csv(codebook_pre, file = "{filepath-to-codebok}")
```

3. Read in the data and rename the variables with the codebook.

```{r import}
# 3. Read in the data and rename the vars using readRenameData(), passing the file path and the edited codebook:
pre_data <- blackstone::readRenameData(pre_data_fp, codebook = codebook_pre)
pre_data
```

The SurveyMonkey example data is now imported with names taken from the codebook column `variable_name`:

```{r data_names}
names(pre_data)
```

```{r, include=FALSE}
# TODO add link to vignette below
```

The vignette `Importing Data using blackstone` goes into deeper detail into using `blackstone` to read in data into `R`.


## Data analysis and statistical inference

